<h1 class="page-heading">Tableau de bord</h1>
<div id="counters"><%= render "admin/dashboard/counters" %></div>

<h4 class="small-title" style="margin-top: 30px">IMPAYES</h4>

<div class="the-box">
	<div class="table-responsive">
		<table class="table table-striped table-hover datatable" id="lessons-datatable">
			<thead class="the-box dark full">
				<tr>
          <th style="width:200px">Actions</th>
          <th>Elève</th>
          <th>Nombre de cours impayés</th>
          <th>Montant total impayé</th>
                  </tr>
			</thead>
			<tbody id="students_data">
        <% Student.joins(:line_items).where("line_items.paid = ?", false).distinct.each do |student| %>
          <tr id="student_<%= student.id %>">
            <td>
              <a class="btn btn-info" href="<%= edit_admin_student_path(student) %>"><i class="fa fa-pencil"></i> Ouvrir l'élève</a>
            </td>
            <td><%= student.name %></td>
            <td><%= student.lessons.joins(:line_items).where("line_items.paid = ?", false).distinct.count %></td>
            <td><%= student.lessons.joins(:line_items).where("line_items.paid = ?", false).distinct.sum {|l| l.total_price} %></td>
          </tr>
        <% end %>
			</tbody>
		</table>
	</div><!-- /.table-responsive -->
</div><!-- /.the-box -->
<!-- End static table -->